# AIVJ 优化计划分析报告（通俗版）

> 生成时间：2026-01-28
> 目标读者：使用自然语言 AI 编程的用户

---

## 1. 这份报告是干什么的？

这份报告帮你**理解当前 AIVJ 自动演出功能的现状**，告诉你：
- 哪些功能真的完成了
- 哪些功能说完成了但其实没做
- 接下来应该让 AI 做什么

AIVJ 就是"AI 自动演出"——根据音乐自动切换视觉效果。

---

## 2. 好消息：这些功能确实完成了 ✅

| 功能 | 作用 | 状态 |
|------|------|------|
| **Run Manifest 系统** | 记录每个预设的表现数据（亮度、运动、节奏） | ✅ 完成 |
| **硬失败过滤** | 自动跳过会崩溃的预设 | ✅ 完成 |
| **Dashboard API** | 提供一个面板查看预设状态 | ✅ 完成 |
| **收藏/不喜欢按钮** | 可以标记喜欢和不喜欢的预设 | ✅ 完成 |
| **导出/导入收藏** | 可以备份和恢复收藏数据 | ✅ 完成 |
| **产物面板性能优化** | 大量预设时界面不卡顿 | ✅ 完成 |
| **性能预算动态调整** | 根据电脑性能自动调整画质 | ✅ 完成 |

---

## 3. 坏消息：这些功能说完成了但其实没做 ⚠️

| 功能 | 问题 | 怎么修 |
|------|------|--------|
| **AIVJ 选择器** | 核心文件是空的，只有注释 | 需要让 AI 实现 `aivjStyleIndexV0.ts` |
| **权重选择 (weightByPresetId)** | 函数定义了但没被调用 | 需要让 AI 在 `unifiedAivjController.ts` 中调用它 |

**简单说**：AIVJ 的"智能选择"功能只写了一半，另一半还没做。

---

## 4. 接下来应该让 AI 做什么？

### 优先级 1：修复 AIVJ 选择器（中等工作量）

**告诉 AI 的话**：
> "实现 `src/features/presets/aivjStyleIndexV0.ts` 文件。这个文件需要：
> 1. 创建一个函数，根据 manifest 数据选择预设
> 2. 集成 `weightByPresetId` 回调，根据预设的历史表现（亮度、运动、评分）加权选择
> 3. 在 `unifiedAivjController.ts` 中调用这个选择函数
> 参考 `runManifestStore.ts` 中的 `pickNextPresetByStyleV0` 函数"

**预期效果**：AI 能够根据音乐特征智能选择合适的预设。

---

### 优先级 2：拆分过大的文件（较大工作量）

**告诉 AI 的话**：
> "`src/app/bootstrap.ts` 文件有 12000 行，太大了。请把它拆成多个文件：
> - `bootstrapOrchestrator.ts` - 主协调逻辑
> - `controlPlane.ts` - 控制逻辑
> - `performanceCoordinator.ts` - 性能协调
> - `renderLoop.ts` - 渲染循环
> 每个文件不超过 500 行"

**预期效果**：代码更容易维护，改东西不容易改出问题。

---

### 优先级 3：添加测试（中等工作量）

**告诉 AI 的话**：
> "给项目添加 Vitest 单元测试框架，覆盖：
> - `AudioBus` 的音频分析逻辑
> - `PresetsController` 的预设加载逻辑
> - `runManifestStore` 的 manifest 读写逻辑"

**预期效果**：以后改代码不怕改坏，测试会自动检查。

---

## 5. 总结

| 类别 | 数量 | 建议 |
|------|------|------|
| 真正完成的功能 | 7 个 | 不用管 |
| 说完成但没做的功能 | 2 个 | 优先级 1 修复 |
| 建议改进的架构 | 3 个 | 优先级 2-3 处理 |

**下一步**：让 AI 先做优先级 1（修复 AIVJ 选择器），这是目前最关键的。

---

## 6. 快速参考：相关文件

| 文件 | 用途 | 当前状态 |
|------|------|----------|
| `src/features/presets/aivjStyleIndexV0.ts` | AIVJ 选择器 | ❌ 空文件 |
| `src/features/aivj/unifiedAivjController.ts` | 统一控制器 | ⚠️ 需调用选择器 |
| `src/features/presets/runManifestStore.ts` | 数据存储 | ✅ 正常 |
| `src/app/bootstrap.ts` | 主入口 | ⚠️ 太大（12000行） |

---

*通俗版报告，由 Clawdbot AI Team 整理*
