services:
  newliveweb-dev:
    build:
      context: .
      dockerfile: Dockerfile.dev
    container_name: newliveweb-dev
    ports:
      - "5174:5174"
    environment:
      # NAS / network filesystem watchers often need polling for reliable HMR.
      CHOKIDAR_USEPOLLING: "1"
      CHOKIDAR_INTERVAL: "250"
      WATCHPACK_POLLING: "true"
      WATCHPACK_POLLING_INTERVAL: "250"
      # Optional: enable /__local_audio inside the container by mounting a folder and setting this.
      # LOCAL_AUDIO_ROOT: "/media/audio"
    volumes:
      - ./:/app
      - newliveweb_node_modules:/app/node_modules
    restart: unless-stopped
    profiles: ["dev"]

  newliveweb:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: newliveweb
    ports:
      - "8080:80"
    restart: unless-stopped
    profiles: ["prod"]

volumes:
  newliveweb_node_modules:
